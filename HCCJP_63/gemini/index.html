<!DOCTYPE html>
<html>
<head>
    <title>リアルタイム投票システム</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
</head>
<body>
    <h1>好きなプログラミング言語は？</h1>
    <button onclick="vote('JavaScript')">JavaScript</button>
    <button onclick="vote('Python')">Python</button>
    <button onclick="vote('C#')">C#</button>
    <button onclick="vote('Java')">Java</button>

    <canvas id="voteChart" width="400" height="400"></canvas>

    <script>
        const results = {
            'JavaScript': 0,
            'Python': 0,
            'C#': 0,
            'Java': 0
        };

        const ctx = document.getElementById('voteChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: Object.keys(results),
                datasets: [{
                    data: Object.values(results),
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                }]
            }
        });

        const connection = new signalR.HubConnectionBuilder()
            .withUrl('https://func-vote-demo.azurewebsites.net/api')
            .build();

        connection.on('newVote', (vote) => {
            results[vote]++;
            chart.data.datasets[0].data = Object.values(results);
            chart.update();
        });

        connection.start().catch(err => console.error(err.toString()));

        function vote(option) {
            fetch('https://func-vote-demo.azurewebsites.net/api/sendVote', {
                method: 'POST',
                body: option
            });
        }
    </script>
</body>
</html>
